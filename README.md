# CF-GNNExplainer

This repository uses the codes from the [CF-GNNExplainer: Counterfactual Explanations for Graph Neural Networks](https://arxiv.org/abs/2102.03322) paper. The goal is to run numerical experiments of CF-GNNExplainer on real-world datasets for node classification. There is as yet no such dataset with a ground truth about explainability of nodes.

Unlike the [GraphSVX](https://arxiv.org/pdf/2104.10482.pdf) methodology for annotating [MUTAG](https://huggingface.co/datasets/graphs-datasets/MUTAG) graphs, which is based on the knowl-
edge that carbon rings with NH<sub>2</sub> or NO<sub>2</sub> groups are mutagenic, MUTAG cannot be annotated at the
level of molecule atoms. Or at least, we are not chemists, and we donâ€™t have the knowledge to do so.

On the other hand, with other types of data, we are able to obtain ground truth based on our
intuition, as a graph representing links between individuals, such as connections on a social network.
If our GNN aims to classify nodes according to their level of connection to others, we could explain
its predictions by basic but meaningful notions of the level of connectivity between nodes.

The following implementation adopts this intuition. Ground truth are generated through three
different node connectivity measures on a Facebook graph dataset provided by [SNAP](http://snap.stanford.edu) available [here](http://snap.stanford.edu/data/ego-Facebook.html) that represents social circles.

Using the social circles Facebook dataset, the ground truth for explainability had to be able to express the connectivity of a node to others in a graph (the connectivity of a Facebook user to others, in terms of friends list). Three metrics were chosen:

- **Degree centrality:** corresponds to the fraction of nodes a node *v* is connected to. This value is normalized by dividing by the maximum possible degree in a simple graph *n - 1* with *n* the number of nodes in *G*.
- **Clustering coefficient:** it is the fraction of possible triangles through a node *v* that exist. This method is inspired by the one used in GraphSVX to label MUTAG molecules.
- **Eigenvector centrality:** The centrality for node *v* is the *v-th* element of a left eigenvector associated with the eigenvalue \( \lambda \) of maximum modulus that is positive. This measure is inspired by the one used in [PageRank](https://www.cis.upenn.edu/~mkearns/teaching/NetworkedLife/pagerank.pdf). The difference is that they use the in-degree for a node, which corresponds to the number of edges pointing to the node, and is therefore suited for directed graph. As circles 1 and 2 are undirected graph, the simpler version is adopted.

## Requirements
To install requirements, please copy-paste the following command line:
```shell
pip install -r requirements.txt
```

## Data
Original Facebook circles are in ```data/```. Graphs datasets are available and ready to be used in the folder ```data/gnn_explainer/```. They were generated by running:
```shell
python circle_dataloader.py --data=circle1
```
> The other arguments are --threshold (i.e. the value under which labels are set to 0) and --GT (i.e. the metrics to be used to generate ground truth).


## Training the GNN model
First do ```cd src```, then run:
```shell
python train --dataset=circle1_degree_centrality_GT
```
> The other available circle datasets are ```circle1_degree_centrality_GT```, ```circle1_clustering_coeff_GT``` and ```circle1_eigenvector_centrality_GT``` (change ```circle1```to ```circle2```for the other circle data), but you can also find those used in the original paper starting with ```syn```.

## Training the CF-GNNExplainer model
Run the following example command line:
```shell
python train --dataset=circle1_degree_centrality_GT --lr=0.01 --beta=0.5 --n_momentum=0.9 --optimizer=SGD
```
> This will create another folder in the main directory called 'results', where the results files will be stored.

## Evaluation

Evaluate your results by running:
```shell
python evaluate.py --path=../results/<NAME OF RESULTS FILE>
```
>>>>>>> 3ef71c9b26e5d9951f156f3b14c3e2d4d572dae6
